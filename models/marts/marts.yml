version: 2

models:
  - name: rep_sales_funnel_monthly
    description: >
      Monthly sales funnel reporting model showing deal counts across all funnel stages.
      Combines stage-based transitions and activity-based metrics (Sales Call 1 and 2)
      to provide a complete view of the sales pipeline by month and funnel step.
      
      Grain: One row per month per funnel step.
      
      This model ensures all months and all funnel steps are represented (using a cross join
      of months and stages as a spine) to facilitate time-series analysis and visualization.
    columns:
      - name: month
        description: Month in YYYY-MM format
        tests:
          - not_null
      - name: kpi_name
        description: >
          KPI name for the funnel step. One of: Lead Generation, Qualified Lead, 
          Sales Call 1, Needs Assessment, Sales Call 2, Proposal/Quote Preparation, 
          Negotiation, Closing, Implementation/Onboarding, Follow-up/Customer Success, 
          Renewal/Expansion
        tests:
          - not_null
          - accepted_values:
              values:
                - 'Lead Generation'
                - 'Qualified Lead'
                - 'Sales Call 1'
                - 'Needs Assessment'
                - 'Sales Call 2'
                - 'Proposal/Quote Preparation'
                - 'Negotiation'
                - 'Closing'
                - 'Implementation/Onboarding'
                - 'Follow-up/Customer Success'
                - 'Renewal/Expansion'
      - name: funnel_step
        description: Display identifier for the funnel step (e.g., '1', '2', '2.1', '3', '3.1')
        tests:
          - not_null
      - name: deals_count
        description: >
          Count of distinct deals that reached this funnel step in this month.
          Combines both stage transitions and completed activities. Zero values 
          indicate no deals reached that stage in that month.
        tests:
          - not_null